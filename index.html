<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¸ìŠ¤íƒ€ ë¼ì´í¬ ì›¹</title>
    <link rel="stylesheet" href="css/style.css">
    
    <script type="text/javascript" src="https://code.jquery.com/jquery-latest.js"></script>
    <script type="text/javascript" src="https://sgisapi.kostat.go.kr/OpenAPI3/auth/javascriptAuth?consumer_key=dc1f99eac61249708453"></script>
    
</head>
<body>
    <header class="main-header">
        <img src="images/logo.png" alt="ë¡œê³ " class="header-logo">
    </header>

    <nav class="sub-nav">
        <button class="nav-button active" id="liveStatusBtn">ì‹¤ì‹œê°„ í˜„í™©</button>
        <button class="nav-button" id="reportMapBtn">ì œë³´ ì§€ë„</button>
    </nav>

    <main class="content-area">
        <section id="liveStatusSection" class="active-section">
            <h2>ì‹¤ì‹œê°„ í˜„í™©</h2>
            <div class="post-feed">
                <div class="post-item">
                    <img src="https://via.placeholder.com/300x200?text=ê²Œì‹œë¬¼1" alt="ê²Œì‹œë¬¼ ì´ë¯¸ì§€" class="post-image">
                    <p class="post-caption">ì²« ë²ˆì§¸ ê²Œì‹œë¬¼ ë‚´ìš©ì…ë‹ˆë‹¤. #ì¼ìƒ #ì •ë³´</p>
                </div>
                <div class="post-item">
                    <img src="https://via.placeholder.com/300x200?text=ê²Œì‹œë¬¼2" alt="ê²Œì‹œë¬¼ ì´ë¯¸ì§€" class="post-image">
                    <p class="post-caption">ë‘ ë²ˆì§¸ ê²Œì‹œë¬¼ì…ë‹ˆë‹¤. #ë‚ ì”¨ #ê³µìœ </p>
                </div>
                </div>
        </section>

        <section id="reportMapSection" class="hidden-section">
            <h2>ì œë³´ ì§€ë„</h2>
            <div class="map-container" id="map-container">
                </div>
        </section>
    </main>

    <footer class="main-footer">
        <button class="footer-btn active" id="homeBtn">
            <img src="https://via.placeholder.com/24?text=ğŸ " alt="í™ˆ">
            <span>í™ˆ</span>
        </button>
        <button class="footer-btn" id="searchBtn">
            <img src="https://via.placeholder.com/24?text=ğŸ”" alt="ë‹ë³´ê¸°">
            <span>ë‹ë³´ê¸°</span>
        </button>
        <button class="footer-btn large-btn" id="addBtn">
            <img src="https://via.placeholder.com/30?text=â•" alt="ì¶”ê°€">
            <span>ì¶”ê°€</span>
        </button>
        <button class="footer-btn" id="messageBtn">
            <img src="https://via.placeholder.com/24?text=ğŸ’¬" alt="ë§í’ì„ ">
            <span>ë©”ì‹œì§€</span>
        </button>
        <button class="footer-btn" id="profileBtn">
            <img src="https://via.placeholder.com/24?text=ğŸ‘¤" alt="í”„ë¡œí•„">
            <span>í”„ë¡œí•„</span>
        </button>
    </footer>

    <script src="js/script.js"></script>
    
    <script type="text/javascript">
        let mapInstance = null; // ì§€ë„ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì €ì¥í•  ë³€ìˆ˜

        // Geolocation APIë¥¼ ì‚¬ìš©í•˜ì—¬ í˜„ì¬ ìœ„ì¹˜ë¥¼ ê°€ì ¸ì˜¤ê³  ì§€ë„ë¥¼ ë¡œë“œí•˜ëŠ” í•¨ìˆ˜
        function loadMapWithCurrentLocation() {
            if (mapInstance === null) { // ì§€ë„ê°€ ì•„ì§ ìƒì„±ë˜ì§€ ì•Šì•˜ì„ ê²½ìš°ì—ë§Œ ìƒì„±
                mapInstance = sop.map('map-container'); // ì§€ë„ ì»¨í…Œì´ë„ˆì— ì§€ë„ ìƒì„±
            }

            // ê¸°ë³¸ ìœ„ì¹˜ (ëŒ€ì „) ì„¤ì •: ì‚¬ìš©ì ìœ„ì¹˜ë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í•  ê²½ìš° ì‚¬ìš©
            // ë§ˆì»¤ ìƒì„± ì˜ˆì œ ì½”ë“œë¥¼ ì°¸ê³ í•˜ì—¬ 953427, 1950827 (ëŒ€ì „ ê·¼ì²˜)ìœ¼ë¡œ ë³€ê²½í–ˆìŠµë‹ˆë‹¤.
            let defaultCenter = sop.utmk(953427, 1950827); 
            let defaultZoom = 9; // ì¤Œ ë ˆë²¨ì€ 9ë¡œ ìœ ì§€

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        // ìœ„ì¹˜ ì •ë³´ ê°€ì ¸ì˜¤ê¸° ì„±ê³µ
                        const lat = position.coords.latitude;
                        const lng = position.coords.longitude;
                        
                        // sop.LatLng ê°ì²´ë¥¼ ì‚¬ìš©í•˜ì—¬ ìœ„ê²½ë„ë¥¼ UTM-K ì¢Œí‘œë¡œ ë³€í™˜
                        const utmkXY = new sop.LatLng(lat, lng);
                        const currentUtmk = sop.utmk(utmkXY.x, utmkXY.y); // ë§ˆì»¤ ìƒì„±ì„ ìœ„í•´ UTM-K ê°ì²´ë¡œ ë³€í™˜

                        mapInstance.setView(currentUtmk, defaultZoom); // í˜„ì¬ ìœ„ì¹˜(UTM-K)ë¡œ ì§€ë„ ì¤‘ì‹¬ ì„¤ì •
                        console.log(`í˜„ì¬ ìœ„ì¹˜: ìœ„ë„ ${lat}, ê²½ë„ ${lng}`);
                        console.log(`ë³€í™˜ëœ UTM-K: x=${utmkXY.x}, y=${utmkXY.y}`);

                        // ---------- í˜„ì¬ ìœ„ì¹˜ì— ê¸°ë³¸ ë§ˆì»¤ ì¶”ê°€ ì‹œì‘ ----------
                        const currentPositionMarker = sop.marker([utmkXY.x, utmkXY.y]); // UTM-K ì¢Œí‘œ ë°°ì—´ë¡œ ë§ˆì»¤ ìƒì„±
                        currentPositionMarker.addTo(mapInstance);
                        currentPositionMarker.bindPopup("<b>í˜„ì¬ ë‚˜ì˜ ìœ„ì¹˜</b><br>ì—¬ê¸°ì—ìš”!");
                        // ---------- í˜„ì¬ ìœ„ì¹˜ì— ê¸°ë³¸ ë§ˆì»¤ ì¶”ê°€ ë ----------

                    },
                    (error) => {
                        // ìœ„ì¹˜ ì •ë³´ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨ ë˜ëŠ” ê¶Œí•œ ê±°ë¶€
                        console.error("ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤:", error);
                        alert("ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê¸°ë³¸ ìœ„ì¹˜ë¡œ ì§€ë„ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.");
                        mapInstance.setView(defaultCenter, defaultZoom); // ê¸°ë³¸ ìœ„ì¹˜ë¡œ ì§€ë„ ì¤‘ì‹¬ ì„¤ì •
                        
                        // ê¸°ë³¸ ìœ„ì¹˜ì— ê¸°ë³¸ ë§ˆì»¤ ì¶”ê°€ (ìœ„ì¹˜ ì •ë³´ ì‹¤íŒ¨ ì‹œ)
                        const defaultPositionMarker = sop.marker([defaultCenter.x, defaultCenter.y]);
                        defaultPositionMarker.addTo(mapInstance);
                        defaultPositionMarker.bindPopup("<b>ê¸°ë³¸ ìœ„ì¹˜</b><br>ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");

                    },
                    {
                        enableHighAccuracy: true, // ë†’ì€ ì •í™•ë„ ìš”ì²­
                        timeout: 5000, // 5ì´ˆ ì•ˆì— ìœ„ì¹˜ë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í•˜ë©´ íƒ€ì„ì•„ì›ƒ
                        maximumAge: 0 // ìºì‹œëœ ìœ„ì¹˜ ì‚¬ìš© ì•ˆ í•¨
                    }
                );
            } else {
                // Geolocationì„ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €
                alert("ì´ ë¸Œë¼ìš°ì €ì—ì„œëŠ” ìœ„ì¹˜ ì •ë³´ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ê¸°ë³¸ ìœ„ì¹˜ë¡œ ì§€ë„ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.");
                mapInstance.setView(defaultCenter, defaultZoom); // ê¸°ë³¸ ìœ„ì¹˜ë¡œ ì§€ë„ ì¤‘ì‹¬ ì„¤ì •

                // ê¸°ë³¸ ìœ„ì¹˜ì— ê¸°ë³¸ ë§ˆì»¤ ì¶”ê°€ (Geolocation ë¯¸ì§€ì› ì‹œ)
                const defaultPositionMarker = sop.marker([defaultCenter.x, defaultCenter.y]);
                defaultPositionMarker.addTo(mapInstance);
                defaultPositionMarker.bindPopup("<b>ê¸°ë³¸ ìœ„ì¹˜</b><br>ë¸Œë¼ìš°ì €ê°€ Geolocationì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
            }
        }
    </script>
</body>
</html>